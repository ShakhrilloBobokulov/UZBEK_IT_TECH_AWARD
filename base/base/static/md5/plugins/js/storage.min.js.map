{"version":3,"file":"storage.min.js","sources":["../../../src/plugins/storage/js/storage.js"],"sourcesContent":["const NAME = 'storage';\n\nclass Storage {\n  // Getters\n  static get NAME() {\n    return NAME;\n  }\n\n  // Public\n\n  // Private\n\n  // Static\n  static set(name, value, expires) {\n    // check expiry when storage is setting\n    this.checkExpiry();\n\n    localStorage.setItem(name, JSON.stringify(value));\n\n    if (typeof expires === 'number') {\n      const expiryList = this.get('expiryList') || [];\n\n      // expiry in days\n      expires = new Date(Number(new Date()) + expires * 1000 * 60 * 60 * 24);\n\n      if (this.isPresentOnExpiryList(name)) {\n        const index = expiryList.findIndex((el) => el[name] !== undefined);\n        expiryList[index][name] = expires;\n      } else {\n        expiryList.push({ [name]: expires });\n      }\n\n      localStorage.setItem('expiryList', JSON.stringify(expiryList));\n    }\n\n    return `${name}: ${value}, expiries: ${expires}`;\n  }\n\n  static get(name) {\n    // check expiry when storage is getting\n    this.checkExpiry();\n\n    return JSON.parse(localStorage.getItem(name));\n  }\n\n  static remove(name) {\n    // check expiry when storage is removing\n    this.checkExpiry();\n\n    localStorage.removeItem(name);\n\n    const expiryList = this.get('expiryList') || [];\n\n    if (this.isPresentOnExpiryList(name)) {\n      const filteredList = expiryList.filter((el) => {\n        const elKey = Object.keys(el);\n        return elKey[0] !== name;\n      });\n\n      localStorage.setItem('expiryList', JSON.stringify(filteredList));\n    }\n  }\n\n  static isPresentOnExpiryList(name) {\n    const expiryList = this.get('expiryList') || [];\n    return expiryList.some((el) => {\n      return el[name] !== undefined;\n    });\n  }\n\n  static check(name, time, callback) {\n    const expiryList = this.get('expiryList') || [];\n\n    const filteredList = expiryList.filter((el) => {\n      const elKey = Object.keys(el);\n      return elKey[0] === name;\n    });\n\n    // time in seconds\n    time *= 6000;\n\n    const intervalId = setInterval(() => {\n      if (new Date(filteredList[0][name]) < new Date()) {\n        callback();\n        clearInterval(intervalId);\n      }\n\n      this.checkExpiry();\n    }, time);\n  }\n\n  static checkExpiry() {\n    const expiryList = JSON.parse(localStorage.getItem('expiryList')) || [];\n    const now = new Date();\n\n    expiryList.filter((el) => {\n      const elKey = Object.keys(el);\n\n      if (now > new Date(el[elKey])) {\n        localStorage.removeItem(elKey[0]);\n      }\n\n      return el[elKey] >= now;\n    });\n  }\n\n  static showModalNewUser(id) {\n    if (this.get('is-first-visit') === null) {\n      const modalElement = document.getElementById(id);\n\n      if (modalElement) {\n        const modal = new mdb.Modal(modalElement);\n        modal.show();\n\n        modalElement.addEventListener('hidden.bs.modal', () => {\n          this.set('is-first-visit', false);\n        });\n      }\n    }\n  }\n\n  static showModalScoring(id, value) {\n    const counter = Number(this.get('visit-counter')) || 0;\n    const newCounter = counter + 1;\n\n    this.set('visit-counter', newCounter);\n\n    if (newCounter === value) {\n      const modalElement = document.getElementById(id);\n\n      if (modalElement) {\n        const modal = new mdb.Modal(modalElement);\n        modal.show();\n      }\n    }\n  }\n}\n\nexport default Storage;\n"],"names":["NAME","set","name","value","expires","this","checkExpiry","localStorage","setItem","JSON","stringify","expiryList","get","Date","Number","isPresentOnExpiryList","index","findIndex","el","push","parse","getItem","remove","removeItem","filteredList","filter","Object","keys","some","check","time","callback","intervalId","setInterval","clearInterval","now","elKey","showModalNewUser","id","modalElement","document","getElementById","mdb","Modal","show","addEventListener","showModalScoring","newCounter"],"mappings":"+OAEA,MAEE,eAAWA,GACF,MALE,SAMV,CAOD,UAAOC,CAAIC,EAAMC,EAAOC,GAMlB,GAJJC,KAAKC,cAELC,aAAaC,QAAQN,EAAMO,KAAKC,UAAUP,IAEnB,iBAAZC,EAAsB,CAC/B,MAAMO,EAAaN,KAAKO,IAAI,eAAiB,GAKzC,GAFMR,EAAA,IAAIS,KAAKC,OAAW,IAAAD,MAAoB,IAAVT,EAAiB,GAAK,GAAK,IAE/DC,KAAKU,sBAAsBb,GAAO,CAC9B,MAAAc,EAAQL,EAAWM,WAAWC,QAAoB,IAAbA,EAAGhB,KACnCS,EAAAK,GAAOd,GAAQE,CAClC,MACQO,EAAWQ,KAAK,CAAEjB,CAACA,GAAOE,IAG5BG,aAAaC,QAAQ,aAAcC,KAAKC,UAAUC,GACnD,CAED,MAAO,GAAGT,MAASC,gBAAoBC,GACxC,CAED,UAAOQ,CAAIV,GAIT,OAFAG,KAAKC,cAEEG,KAAKW,MAAMb,aAAac,QAAQnB,GACxC,CAED,aAAOoB,CAAOpB,GAEZG,KAAKC,cAELC,aAAagB,WAAWrB,GAExB,MAAMS,EAAaN,KAAKO,IAAI,eAAiB,GAEzC,GAAAP,KAAKU,sBAAsBb,GAAO,CACpC,MAAMsB,EAAeb,EAAWc,QAAQP,GACxBQ,OAAOC,KAAKT,GACb,KAAOhB,IAGtBK,aAAaC,QAAQ,aAAcC,KAAKC,UAAUc,GACnD,CACF,CAED,4BAAOT,CAAsBb,GAEpB,OADYG,KAAKO,IAAI,eAAiB,IAC3BgB,MAAMV,QACF,IAAbA,EAAGhB,IAEb,CAED,YAAO2B,CAAM3B,EAAM4B,EAAMC,GACvB,MAEMP,GAFanB,KAAKO,IAAI,eAAiB,IAEba,QAAQP,GACxBQ,OAAOC,KAAKT,GACb,KAAOhB,IAMhB8B,EAAaC,aAAY,KACzB,IAAIpB,KAAKW,EAAa,GAAGtB,IAAa,IAAAW,WAExCqB,cAAcF,IAGhB3B,KAAKC,aAAW,GARVwB,GAAA,IAUT,CAED,kBAAOxB,GACC,MAAAK,EAAaF,KAAKW,MAAMb,aAAac,QAAQ,gBAAkB,GAC/Dc,MAAUtB,KAELF,EAAAc,QAAQP,IACX,MAAAkB,EAAQV,OAAOC,KAAKT,GAMnB,OAJHiB,EAAM,IAAItB,KAAKK,EAAGkB,KACP7B,aAAAgB,WAAWa,EAAM,IAGzBlB,EAAGkB,IAAUD,CAAA,GAEvB,CAED,uBAAOE,CAAiBC,GACtB,GAAmC,OAA/BjC,KAAKO,IAAI,kBAA4B,CACjC,MAAA2B,EAAeC,SAASC,eAAeH,GAE7C,GAAIC,EAAc,CACF,IAAIG,IAAIC,MAAMJ,GACtBK,OAEOL,EAAAM,iBAAiB,mBAAmB,KAC1CxC,KAAAJ,IAAI,kBAAkB,EAAK,GAEnC,CACF,CACF,CAED,uBAAO6C,CAAiBR,EAAInC,GAC1B,MACM4C,GADUjC,OAAOT,KAAKO,IAAI,mBAAqB,GACxB,EAI7B,GAFKP,KAAAJ,IAAI,gBAAiB8C,GAEtBA,IAAe5C,EAAO,CAClB,MAAAoC,EAAeC,SAASC,eAAeH,GAE7C,GAAIC,EAAc,CACF,IAAIG,IAAIC,MAAMJ,GACtBK,MACP,CACF,CACF"}